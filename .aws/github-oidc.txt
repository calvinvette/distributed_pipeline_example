# .aws.github-oidc

This is a hardened GitHub OIDC trust policy for the IAM role that your workflow will assume. 
It restricts assumption to a specific GitHub org/repo and (optionally) to version tags only 
(e.g., refs/tags/v0.1.0), which is the right control for your CodeArtifact publisher role.

Replace:
	•	YOUR_GITHUB_ORG (e.g., acme-corp)
	•	YOUR_REPO (e.g., vision-datasci-package)
	•	YOUR_AWS_ACCOUNT_ID


In the policy file,

	•	aud == sts.amazonaws.com: ensures the token is intended for AWS STS.
	•	repository == ORG/REPO: hard binds the role to exactly one repo.
	•	sub == repo:ORG/REPO:ref:refs/tags/v*: restricts assumption to runs coming from tag refs beginning with v.

This is aligned with the publish job you requested: “publish only on tags.”


Optional hardening variants

A) Allow either tags or main branch (if you want manual publish on main)

Replace the single StringLike with:

"StringLike": {
  "token.actions.githubusercontent.com:sub": [
    "repo:YOUR_GITHUB_ORG/YOUR_REPO:ref:refs/tags/v*",
    "repo:YOUR_GITHUB_ORG/YOUR_REPO:ref:refs/heads/main"
  ]
}

B) Restrict to a specific workflow file (stronger than branch/tag-only)

This is commonly done using the job_workflow_ref claim (available in GitHub’s OIDC token). Add:

"StringLike": {
  "token.actions.githubusercontent.com:job_workflow_ref": "YOUR_GITHUB_ORG/YOUR_REPO/.github/workflows/ci.yml@refs/tags/v*",
  "token.actions.githubusercontent.com:sub": "repo:YOUR_GITHUB_ORG/YOUR_REPO:ref:refs/tags/v*"
}

If you adopt this, it prevents a different workflow file from assuming the role even in the same repo.
